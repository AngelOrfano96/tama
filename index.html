<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Tamagotchi Browser</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .fullscreen {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
    }
    .center {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .hidden { display: none !important; }
    body, html { height: 100%; min-height: 100vh; }
  </style>
</head>
<body>
  <div id="app-root">
    <!-- Login / Registrazione -->
    <div id="login-container" class="fullscreen center">
      <form id="auth-form" class="form-box">
        <h2>Login / Registrati</h2>
        <input type="email" id="email-input" placeholder="Email" required />
        <input type="password" id="password-input" placeholder="Password" required />
        <div class="buttons">
          <button type="submit" id="login-btn">Entra</button>
          <button type="button" id="signup-btn">Registrati</button>
        </div>
        <div id="auth-error" class="error"></div>
      </form>
    </div>

    <!-- Selezione Uovo -->
    <div id="egg-selection" class="fullscreen center hidden">
      <div class="form-box">
        <h2>Scegli un uovo</h2>
        <div class="eggs-grid">
          <img src="assets/eggs/egg_1.png" class="egg selectable" data-egg="1" />
          <img src="assets/eggs/egg_2.png" class="egg selectable" data-egg="2" />
          <img src="assets/eggs/egg_3.png" class="egg selectable" data-egg="3" />
          <img src="assets/eggs/egg_4.png" class="egg selectable" data-egg="4" />
          <img src="assets/eggs/egg_5.png" class="egg selectable" data-egg="5" />
          <img src="assets/eggs/egg_6.png" class="egg selectable" data-egg="6" />
          <img src="assets/eggs/egg_7.png" class="egg selectable" data-egg="7" />
          <img src="assets/eggs/egg_8.png" class="egg selectable" data-egg="8" />
        </div>
        <button id="confirm-egg-btn" disabled>Conferma Uovo</button>
      </div>
    </div>

    <!-- Gioco -->
    <div id="game" class="fullscreen center hidden">
      <button id="logout-btn" type="button">Logout</button>
      <div class="form-box">
        <div id="level-container" class="level-box">
          <span id="level-label">Livello 1</span>
          <div id="exp-bar-bg" style="display:flex;align-items:center;gap:7px;">
            <span id="exp-label" style="font-size:0.95em;color:#888;font-weight:600;">exp</span>
            <div style="flex:1; position:relative;">
              <div id="exp-bar" style="height:16px;"></div>
              <span id="exp-gain-label" class="exp-gain-label" style="position:absolute;right:5px;top:50%;transform:translateY(-50%);display:none;"></span>
            </div>
          </div>
        </div>
        <img id="pet" alt="Il tuo pet" />
        <div class="bars">
          <div class="bar-label">Fame</div>
          <div id="hunger-bar" class="bar"></div>
          <div class="bar-label">Divertimento</div>
          <div id="fun-bar" class="bar"></div>
          <div class="bar-label">Pulizia</div>
          <div id="clean-bar" class="bar"></div>
        </div>
        <div class="controls">
          <button id="feed-btn" type="button">üçñ Feed</button>
          <button id="play-btn" type="button">üéÆ Play</button>
          <button id="clean-btn" type="button">üßº Clean</button>
        </div>
        <div id="game-over" class="hidden">
          üíî Il tuo pet √® scappato! Vuoi scegliere un nuovo uovo?
          <div id="game-over-buttons">
            <button id="choose-egg-btn" type="button">S√¨</button>
            <button id="exit-btn" type="button">No</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- MODALE MINIGIOCO PRENDIMI-->
    <div id="minigame-modal" class="hidden" style="
      position:fixed; z-index:1000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); display:flex; align-items:center; justify-content:center;">
      <div class="minigame-box" style="
        background:#fcf8e3; border-radius:30px; min-width:380px; min-height:340px; box-shadow:0 6px 40px #0002; padding:28px 34px 34px 34px; display:flex; flex-direction:column; align-items:center; position:relative;">
        <div id="minigame-topbar" style="display: flex; justify-content: space-between; align-items: center; width: 90%; margin-bottom: 14px;">
          <span id="minigame-title" style="font-weight: bold; font-size: 1.18em; color: #2c3e50;">Acchiappa il tuo pet!</span>
          <span id="minigame-timer" style="font-size: 1.2em; color: #2c3e50;"></span>
        </div>
        <canvas id="minigame-canvas" width="320" height="320" style="background:#1a1a1a;border-radius:12px;"></canvas>
        <div id="minigame-ui" style="width:100%;margin-top:18px;display:flex;justify-content:flex-end">
          <button id="minigame-exit-btn" type="button" style="background:#e67e22;color:#fff;font-size:1.06em;padding:8px 18px;border-radius:6px;border:none;cursor:pointer;">Chiudi</button>
        </div>
      </div>
    </div>

    <!-- Minigioco: Fuga dal Dungeon -->
    <div id="maze-minigame-modal" class="modal hidden">
      <div class="minigame-box" style="position:relative;">
        <!-- Il bonus label UNICO e centrato! -->
        <div id="maze-bonus-label" class="exp-gain-label"
          style="display:none;position:absolute;top:16px;left:50%;transform:translateX(-50%);color:#fff;font-size:1.1em;font-weight:700;">
        </div>
        <div class="minigame-header">
          <span id="maze-minigame-timer">30</span> s
          <span style="margin-left:20px;">Punteggio: <span id="maze-minigame-score">0</span></span>
        </div>
        <canvas id="maze-canvas" width="320" height="256" style="background:#222;display:block;margin:auto;border-radius:10px"></canvas>
        <div style="text-align:center;margin-top:1em;">
          <button id="maze-exit-btn">Esci</button>
        </div>
        <div id="maze-touch-controls" class="maze-touch-controls" style="margin-top:18px; display:none;">
          <div class="maze-touch-row">
            <button class="maze-arrow-btn" data-dir="up">‚ñ≤</button>
          </div>
          <div class="maze-touch-row">
            <button class="maze-arrow-btn" data-dir="left">‚óÄ</button>
            <button class="maze-arrow-btn" data-dir="down">‚ñº</button>
            <button class="maze-arrow-btn" data-dir="right">‚ñ∂</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODALE MINI GIOCO SALTA OSTACOLI -->
<div id="jumper-minigame-modal" class="modal hidden">
  <div class="minigame-box" style="position:relative;">
    <div class="minigame-header" style="display:flex;justify-content:space-between;">
      <span id="jumper-minigame-title" style="font-weight: bold; font-size: 1.18em; color: #2c3e50;">Salta gli ostacoli!</span>
      <span id="jumper-minigame-timer">20</span> s
      <span style="margin-left:20px;">Punteggio: <span id="jumper-minigame-score">0</span></span>
    </div>
    <canvas id="jumper-canvas" width="320" height="192" style="background:#222;display:block;margin:auto;border-radius:10px"></canvas>
    <div id="jumper-bonus-label" class="exp-gain-label" style="display:none;position:absolute;top:24px;left:50%;transform:translateX(-50%);color:#fff;font-size:1.15em;font-weight:700;"></div>
    <div style="text-align:center;margin-top:1em;">
      <button id="jumper-mobile-jump-btn"
  style="display:none; width:85vw; max-width:370px; font-size:1.7rem; height:60px; margin:10px auto; background:#f1c40f; color:#2c3e50; border-radius:20px; border:none; font-weight:bold; box-shadow:0 2px 8px #aaa; transition:.2s;">
  SALTA
    </button>

      <button id="jumper-exit-btn">Esci</button>
    </div>
  </div>
</div>

 <!-- ===== MODALE MINIGIOCO CACCIA AL TESORO ===== -->
<div id="treasure-minigame-modal" class="minigame-modal hidden">
  <!-- INFO BAR IN ALTO -->
  <div class="treasure-info-bar-mobile">
    <span><img src="assets/collectibles/coin.png" class="info-icon"> <span id="treasure-minigame-coins">0</span></span>
    <span><img src="assets/bonus/clock.png" class="info-icon"> <span id="treasure-timer">--</span>s</span>
    <span><img src="assets/icons/door.png" class="info-icon"> <span id="treasure-level">1</span></span>
    <span><img src="assets/bonus/clock.png" class="info-icon"> <span id="treasure-minigame-score">0</span></span>
  </div>
  <!-- DUNGEON -->
  <div class="treasure-canvas-wrapper">
    <canvas id="treasure-canvas"></canvas>
    <div id="treasure-feedback-label"
      style="display:none;position:absolute;left:50%;top:110px;z-index:10;font-size:2em;
      font-weight:bold;color:#ffe44c;text-shadow:2px 3px 10px #000a,0 1px 0 #fff;
      pointer-events:none;transform:translateX(-50%);transition:opacity .2s;">
    </div>
  </div>
  <!-- CONTROLLI IN BASSO -->
  <div class="treasure-bottom-controls">
    <div class="treasure-arrows-container">
      <div class="treasure-arrows-row">
        <button class="treasure-arrow-btn" data-dir="up">‚¨ÜÔ∏è</button>
      </div>
      <div class="treasure-arrows-row">
        <button class="treasure-arrow-btn" data-dir="left">‚¨ÖÔ∏è</button>
        <button class="treasure-arrow-btn" data-dir="down">‚¨áÔ∏è</button>
        <button class="treasure-arrow-btn" data-dir="right">‚û°Ô∏è</button>
      </div>
    </div>
    <div class="treasure-exit-area">
      <button id="treasure-exit-btn">Esci</button>
    </div>
  </div>
</div>






    <!-- MODALE SELEZIONE MINIGIOCO -->
    <div id="minigame-select-modal" class="modal hidden">
      <div class="modal-content" style="text-align:center;">
        <h2>Scegli un mini gioco</h2>
        <button id="btn-minigame-catch">Prendimi!</button>
        <button id="btn-minigame-maze" class="minigame-btn">Fuga dal Dungeon</button>
        <button id="btn-minigame-jumper" class="minigame-btn">Salta gli ostacoli</button>
        <button id="btn-minigame-treasure" class="minigame-btn">Caccia al Tesoro</button>

        <!-- Qui in futuro puoi aggiungere altri bottoni/mini giochi -->
        <br>
        <button id="btn-minigame-cancel" class="btn-minigame-cancel" style="margin-top:18px;">Chiudi</button>
      </div>
    </div>

  </div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    window.SUPABASE_URL = 'https://jfycifybshoawhwechdd.supabase.co';
    window.SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpmeWNpZnlic2hvYXdod2VjaGRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwNzM0MDQsImV4cCI6MjA2OTY0OTQwNH0.Gsttr6PLvWIcdwum1WUQXml6BjHsXwYn94BEcyPaZHg';
  </script>
  <script src="minigame-acchiappami.js"></script>
<script src="minigame-cacciaTesoro.js"></script>
<script src="minigame-fugaDungeon.js"></script>
<script src="minigame-saltaOstacoli.js"></script>
<script src="script.js"></script>
</body>
</html>
